---
title: "WNPRC_2018_E1G_PdG_all_runs"
author: "Laura Abondano"
date: "2/17/2019"
output: html_document
---

#General Info
This script contains the same lines of code as the document WNPRC_2018_data.Rmd, but this document analyses all of the EIA results for E1G and PdG in (in 2018?). The code is the same for all runs, but I changed the names for each run in three main places:

1. Change it in the e1g.file.name/pdg.file.name at the beginning of the script
2. Change the sample names for each run accordingly
3. Change file name on the FINAL TABLES section towards the end of the script
4. Still need to change the parameter values (using the specific values form softmaxpro for each run) for the 4-parameter logistic curve

Also, the numbers in the code are generally the same for all runs, except when calculating the dilutions, so check those numbers for each run (especially the volume used in each plate).

The script uses the Optical Density (OD) values that are exported from a plate reader software, and then it uses those values to calculate the hormone concentrations in each sample. 

Chunk for loading libraries:
```{r}
library(dplyr)
library(ggplot2)
library(minpack.lm) # for non-linear models
```

# E1G 2018 samples:
E1G standard values:

#E1G - Woolly 20181101 PoolsPlate

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181101 PoolsPlate.txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-001",
"WNPRC-2018-006",
"WNPRC-2018-050",
"WNPRC-2018-107",
"WNPRC-2018-141",
"WNPRC-2018-149",
"WNPRC-2018-318",
"WNPRC-2018-320",
"WNPRC-2018-337",
"WNPRC-2018-339",
"WNPRC-2018-342",
"WNPRC-2018-348",
"WNPRC-2018-403",
"WNPRC-2018-409",
"WNPRC-2018-410",
"WNPRC-2018-418",
"WNPRC-2018-450",
"WNPRC-2018-028",
"WNPRC-2018-038",
"WNPRC-2018-042",
"WNPRC-2018-378",
"WNPRC-2018-394",
"WNPRC-2018-411",
"WNPRC-2018-414",
"WNPRC-2018-416",
"WNPRC-2018-419",
"WNPRC-2018-425",
"WNPRC-2018-430",
"WNPRC-2018-431",
"WNPRC-2018-438",
"WNPRC-2018-439",
"WNPRC-2018-446",
"WNPRC-2018-447",
"WNPRC-2018-449",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.1,b=1.733,cc=20.47,d=0.02),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-15 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-15 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181101 PoolsPlate
E1G.20181101.testplate.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181101 PoolsPlate") %>% mutate(hormone = "E1G")

E1G.20181101.testplate.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181101 PoolsPlate") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181115 Plate 1 (Cali)


```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181115 Plate 1 (Cali).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-004",
"WNPRC-2018-007",
"WNPRC-2018-015",
"WNPRC-2018-019",
"WNPRC-2018-026",
"WNPRC-2018-035",
"WNPRC-2018-039",
"WNPRC-2018-046",
"WNPRC-2018-069",
"WNPRC-2018-077",
"WNPRC-2018-082",
"WNPRC-2018-087",
"WNPRC-2018-096",
"WNPRC-2018-102",
"WNPRC-2018-108",
"WNPRC-2018-135",
"WNPRC-2018-152",
"WNPRC-2018-163",
"WNPRC-2018-172",
"WNPRC-2018-175",
"WNPRC-2018-183",
"WNPRC-2018-194",
"WNPRC-2018-205",
"WNPRC-2018-222",
"WNPRC-2018-231",
"WNPRC-2018-232",
"WNPRC-2018-239",
"WNPRC-2018-244",
"WNPRC-2018-256",
"WNPRC-2018-257",
"WNPRC-2018-263",
"WNPRC-2018-270",
"WNPRC-2018-280",
"WNPRC-2018-287",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.037,b=1.736,cc=20.45,d=0.074),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181115 Plate 1 (Cali)
E1G.20181115_1.cali.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181115 Plate 1 (Cali)") %>% mutate(hormone = "E1G")

E1G.20181115_1.cali.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181115 Plate 1 (Cali)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181115 Plate 2 (Cali and Chai)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181115 Plate 2 (Cali and Chai).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-298",
"WNPRC-2018-314",
"WNPRC-2018-317",
"WNPRC-2018-330",
"WNPRC-2018-332",
"WNPRC-2018-347",
"WNPRC-2018-354",
"WNPRC-2018-362",
"WNPRC-2018-389",
"WNPRC-2018-408",
"WNPRC-2018-415",
"WNPRC-2018-441",
"WNPRC-2018-011",
"WNPRC-2018-018",
"WNPRC-2018-022",
"WNPRC-2018-034",
"WNPRC-2018-048",
"WNPRC-2018-061",
"WNPRC-2018-063",
"WNPRC-2018-067",
"WNPRC-2018-073",
"WNPRC-2018-088",
"WNPRC-2018-095",
"WNPRC-2018-099",
"WNPRC-2018-106",
"WNPRC-2018-109",
"WNPRC-2018-116",
"WNPRC-2018-125",
"WNPRC-2018-129",
"WNPRC-2018-133",
"WNPRC-2018-143",
"WNPRC-2018-146",
"WNPRC-2018-153",
"WNPRC-2018-162",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.061,b=1.573,cc=18.59,d=0.070),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181115 Plate 2 (Cali and Chai)
E1G.20181115_2.cali_chai.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181115 Plate 2 (Cali and Chai)") %>% mutate(hormone = "E1G")

E1G.20181115_2.cali_chai.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181115 Plate 2 (Cali and Chai)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181115 Plate 3 (Chai and Papaya)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181115 Plate 3 (Chai and Papaya).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-166",
"WNPRC-2018-176",
"WNPRC-2018-187",
"WNPRC-2018-191",
"WNPRC-2018-199",
"WNPRC-2018-202",
"WNPRC-2018-204",
"WNPRC-2018-211",
"WNPRC-2018-220",
"WNPRC-2018-234",
"WNPRC-2018-238",
"WNPRC-2018-242",
"WNPRC-2018-245",
"WNPRC-2018-254",
"WNPRC-2018-262",
"WNPRC-2018-272",
"WNPRC-2018-275",
"WNPRC-2018-288",
"WNPRC-2018-299",
"WNPRC-2018-305",
"WNPRC-2018-310",
"WNPRC-2018-315",
"WNPRC-2018-325",
"WNPRC-2018-333",
"WNPRC-2018-351",
"WNPRC-2018-361",
"WNPRC-2018-363",
"WNPRC-2018-379",
"WNPRC-2018-396",
"WNPRC-2018-404",
"WNPRC-2018-020",
"WNPRC-2018-037",
"WNPRC-2018-041",
"WNPRC-2018-044",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.064,b=1.435,cc=19.11,d=0.046),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181115 Plate 3 (Chai and Papaya)
E1G.20181115_3.chai_papaya.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181115 Plate 3 (Chai and Papaya)") %>% mutate(hormone = "E1G")

E1G.20181115_3.chai_papaya.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181115 Plate 3 (Chai and Papaya)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181115 Plate 4 (Papaya)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181115 Plate 4 (Papaya).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-049",
"WNPRC-2018-059",
"WNPRC-2018-062",
"WNPRC-2018-074",
"WNPRC-2018-083",
"WNPRC-2018-092",
"WNPRC-2018-097",
"WNPRC-2018-115",
"WNPRC-2018-121",
"WNPRC-2018-134",
"WNPRC-2018-139",
"WNPRC-2018-147",
"WNPRC-2018-155",
"WNPRC-2018-158",
"WNPRC-2018-168",
"WNPRC-2018-180",
"WNPRC-2018-186",
"WNPRC-2018-200",
"WNPRC-2018-210",
"WNPRC-2018-212",
"WNPRC-2018-219",
"WNPRC-2018-229",
"WNPRC-2018-241",
"WNPRC-2018-249",
"WNPRC-2018-253",
"WNPRC-2018-264",
"WNPRC-2018-273",
"WNPRC-2018-278",
"WNPRC-2018-281",
"WNPRC-2018-286",
"WNPRC-2018-291",
"WNPRC-2018-301",
"WNPRC-2018-313",
"WNPRC-2018-324",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.094,b=1.645,cc=19.51,d=0.068),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181115 Plate 4 (Papaya)
E1G.20181115_4.papaya.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181115 Plate 4 (Papaya)") %>% mutate(hormone = "E1G")

E1G.20181115_4.papaya.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181115 Plate 4 (Papaya)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181116 Plate 1 (Papaya and Poquer)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181116 Plate 1 (Papaya and Poquer).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-334",
"WNPRC-2018-340",
"WNPRC-2018-345",
"WNPRC-2018-357",
"WNPRC-2018-360",
"WNPRC-2018-369",
"WNPRC-2018-384",
"WNPRC-2018-388",
"WNPRC-2018-393",
"WNPRC-2018-398",
"WNPRC-2018-405",
"WNPRC-2018-413",
"WNPRC-2018-032",
"WNPRC-2018-040",
"WNPRC-2018-043",
"WNPRC-2018-058",
"WNPRC-2018-070",
"WNPRC-2018-072",
"WNPRC-2018-080",
"WNPRC-2018-101",
"WNPRC-2018-105",
"WNPRC-2018-119",
"WNPRC-2018-120",
"WNPRC-2018-123",
"WNPRC-2018-131",
"WNPRC-2018-140",
"WNPRC-2018-145",
"WNPRC-2018-157",
"WNPRC-2018-167",
"WNPRC-2018-170",
"WNPRC-2018-178",
"WNPRC-2018-189",
"WNPRC-2018-196",
"WNPRC-2018-201",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.885,b=1.467,cc=16.65,d=0.047),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181116 Plate 1 (Papaya and Poquer)
E1G.20181116_1.papaya_poquer.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181116 Plate 1 (Papaya and Poquer)") %>% mutate(hormone = "E1G")

E1G.20181116_1.papaya_poquer.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181116 Plate 1 (Papaya and Poquer)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181116 Plate 2 (Poquer and Pepa)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181116 Plate 2 (Poquer and Pepa).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-209",
"WNPRC-2018-221",
"WNPRC-2018-228",
"WNPRC-2018-237",
"WNPRC-2018-246",
"WNPRC-2018-259",
"WNPRC-2018-266",
"WNPRC-2018-267",
"WNPRC-2018-277",
"WNPRC-2018-283",
"WNPRC-2018-294",
"WNPRC-2018-302",
"WNPRC-2018-308",
"WNPRC-2018-311",
"WNPRC-2018-322",
"WNPRC-2018-336",
"WNPRC-2018-346",
"WNPRC-2018-358",
"WNPRC-2018-374",
"WNPRC-2018-386",
"WNPRC-2018-392",
"WNPRC-2018-397",
"WNPRC-2018-422",
"WNPRC-2018-426",
"WNPRC-2018-428",
"WNPRC-2018-433",
"WNPRC-2018-453",
"WNPRC-2018-045",
"WNPRC-2018-053",
"WNPRC-2018-060",
"WNPRC-2018-065",
"WNPRC-2018-085",
"WNPRC-2018-089",
"WNPRC-2018-104",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.895,b=1.638,cc=17.74,d=0.053),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181116 Plate 2 (Poquer and Pepa)
E1G.20181116_2.poquer_pepa.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181116 Plate 2 (Poquer and Pepa)") %>% mutate(hormone = "E1G")

E1G.20181116_2.poquer_pepa.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181116 Plate 2 (Poquer and Pepa)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181116 Plate 3 (Pepa)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181116 Plate 3 (Pepa).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-122",
"WNPRC-2018-132",
"WNPRC-2018-137",
"WNPRC-2018-148",
"WNPRC-2018-154",
"WNPRC-2018-171",
"WNPRC-2018-181",
"WNPRC-2018-190",
"WNPRC-2018-195",
"WNPRC-2018-213",
"WNPRC-2018-217",
"WNPRC-2018-224",
"WNPRC-2018-230",
"WNPRC-2018-240",
"WNPRC-2018-252",
"WNPRC-2018-268",
"WNPRC-2018-284",
"WNPRC-2018-285",
"WNPRC-2018-293",
"WNPRC-2018-297",
"WNPRC-2018-300",
"WNPRC-2018-312",
"WNPRC-2018-323",
"WNPRC-2018-341",
"WNPRC-2018-356",
"WNPRC-2018-359",
"WNPRC-2018-368",
"WNPRC-2018-376",
"WNPRC-2018-383",
"WNPRC-2018-387",
"WNPRC-2018-391",
"WNPRC-2018-420",
"WNPRC-2018-427",
"WNPRC-2018-443",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.837,b=1.730,cc=18.09,d=0.057),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181116 Plate 3 (Pepa)
E1G.20181116_3.pepa.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181116 Plate 3 (Pepa)") %>% mutate(hormone = "E1G")

E1G.20181116_3.pepa.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181116 Plate 3 (Pepa)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181116 Plate 4 (Policarpa)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181116 Plate 4 (Policarpa).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-457",
"WNPRC-2018-460",
"WNPRC-2018-047",
"WNPRC-2018-081",
"WNPRC-2018-117",
"WNPRC-2018-124",
"WNPRC-2018-136",
"WNPRC-2018-144",
"WNPRC-2018-159",
"WNPRC-2018-169",
"WNPRC-2018-179",
"WNPRC-2018-188",
"WNPRC-2018-197",
"WNPRC-2018-208",
"WNPRC-2018-218",
"WNPRC-2018-223",
"WNPRC-2018-227",
"WNPRC-2018-236",
"WNPRC-2018-247",
"WNPRC-2018-260",
"WNPRC-2018-271",
"WNPRC-2018-292",
"WNPRC-2018-296",
"WNPRC-2018-307",
"WNPRC-2018-321",
"WNPRC-2018-331",
"WNPRC-2018-344",
"WNPRC-2018-365",
"WNPRC-2018-370",
"WNPRC-2018-371",
"WNPRC-2018-372",
"WNPRC-2018-382",
"WNPRC-2018-385",
"WNPRC-2018-402",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.901,b=1.735,cc=17.90,d=0.057),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181116 Plate 4 (Policarpa)
E1G.20181116_4.policarpa.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181116 Plate 4 (Policarpa)") %>% mutate(hormone = "E1G")

E1G.20181116_4.policarpa.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181116 Plate 4 (Policarpa)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181117 Plate 1 (Policarpa, Cuenca, and Der)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181117 Plate 1 (Policarpa, Cuenca, and Der).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-424",
"WNPRC-2018-442",
"WNPRC-2018-452",
"WNPRC-2018-455",
"WNPRC-2018-458",
"WNPRC-2018-009",
"WNPRC-2018-012",
"WNPRC-2018-014",
"WNPRC-2018-017",
"WNPRC-2018-023",
"WNPRC-2018-030",
"WNPRC-2018-056",
"WNPRC-2018-066",
"WNPRC-2018-078",
"WNPRC-2018-079",
"WNPRC-2018-086",
"WNPRC-2018-094",
"WNPRC-2018-100",
"WNPRC-2018-111",
"WNPRC-2018-114",
"WNPRC-2018-002",
"WNPRC-2018-010",
"WNPRC-2018-016",
"WNPRC-2018-025",
"WNPRC-2018-052",
"WNPRC-2018-057",
"WNPRC-2018-075",
"WNPRC-2018-090",
"WNPRC-2018-091",
"WNPRC-2018-093",
"WNPRC-2018-103",
"WNPRC-2018-110",
"WNPRC-2018-127",
"WNPRC-2018-138",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.992,b=1.832,cc=21.29,d=0.070),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181117 Plate 1 (Policarpa, Cuenca, and Der)
E1G.20181117_1.policarpa_cuenca_der.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181117 Plate 1 (Policarpa, Cuenca, and Der)") %>% mutate(hormone = "E1G")

E1G.20181117_1.policarpa_cuenca_der.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181117 Plate 1 (Policarpa, Cuenca, and Der)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181117 Plate 2 (Der)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181117 Plate 2 (Der).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-150",
"WNPRC-2018-156",
"WNPRC-2018-173",
"WNPRC-2018-174",
"WNPRC-2018-182",
"WNPRC-2018-192",
"WNPRC-2018-207",
"WNPRC-2018-215",
"WNPRC-2018-216",
"WNPRC-2018-226",
"WNPRC-2018-235",
"WNPRC-2018-248",
"WNPRC-2018-255",
"WNPRC-2018-265",
"WNPRC-2018-276",
"WNPRC-2018-279",
"WNPRC-2018-290",
"WNPRC-2018-303",
"WNPRC-2018-304",
"WNPRC-2018-319",
"WNPRC-2018-327",
"WNPRC-2018-328",
"WNPRC-2018-338",
"WNPRC-2018-343",
"WNPRC-2018-355",
"WNPRC-2018-366",
"WNPRC-2018-380",
"WNPRC-2018-381",
"WNPRC-2018-401",
"WNPRC-2018-412",
"WNPRC-2018-423",
"WNPRC-2018-435",
"WNPRC-2018-444",
"WNPRC-2018-454",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.041,b=1.871,cc=20.63,d=0.083),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181117 Plate 2 (Der)
E1G.20181117_2.der.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181117 Plate 2 (Der)") %>% mutate(hormone = "E1G")

E1G.20181117_2.der.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181117 Plate 2 (Der)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181117 Plate 3 (Der and Gwen)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181117 Plate 3 (Der and Gwen).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-459",
"WNPRC-2018-005",
"WNPRC-2018-008",
"WNPRC-2018-021",
"WNPRC-2018-027",
"WNPRC-2018-033",
"WNPRC-2018-055",
"WNPRC-2018-064",
"WNPRC-2018-068",
"WNPRC-2018-076",
"WNPRC-2018-084",
"WNPRC-2018-098",
"WNPRC-2018-112",
"WNPRC-2018-113",
"WNPRC-2018-126",
"WNPRC-2018-130",
"WNPRC-2018-142",
"WNPRC-2018-151",
"WNPRC-2018-160",
"WNPRC-2018-161",
"WNPRC-2018-164",
"WNPRC-2018-165",
"WNPRC-2018-177",
"WNPRC-2018-184",
"WNPRC-2018-185",
"WNPRC-2018-193",
"WNPRC-2018-198",
"WNPRC-2018-203",
"WNPRC-2018-206",
"WNPRC-2018-214",
"WNPRC-2018-225",
"WNPRC-2018-233",
"WNPRC-2018-243",
"WNPRC-2018-250",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.033,b=1.696,cc=18.94,d=0.075),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181117 Plate 3 (Der and Gwen)
E1G.20181117_3.der_gwen.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181117 Plate 3 (Der and Gwen)") %>% mutate(hormone = "E1G")

E1G.20181117_3.der_gwen.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181117 Plate 3 (Der and Gwen)") %>% mutate(hormone = "E1G")
```

#E1G - Woolly 20181117 Plate 4 (Gwen and males)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G - Woolly 20181117 Plate 4 (Gwen and males).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-251",
"WNPRC-2018-258",
"WNPRC-2018-261",
"WNPRC-2018-269",
"WNPRC-2018-274",
"WNPRC-2018-282",
"WNPRC-2018-289",
"WNPRC-2018-295",
"WNPRC-2018-306",
"WNPRC-2018-309",
"WNPRC-2018-316",
"WNPRC-2018-326",
"WNPRC-2018-335",
"WNPRC-2018-349",
"WNPRC-2018-350",
"WNPRC-2018-352",
"WNPRC-2018-364",
"WNPRC-2018-367",
"WNPRC-2018-373",
"WNPRC-2018-375",
"WNPRC-2018-377",
"WNPRC-2018-395",
"WNPRC-2018-399",
"WNPRC-2018-407",
"WNPRC-2018-421",
"WNPRC-2018-432",
"WNPRC-2018-440",
"WNPRC-2018-445",
"WNPRC-2018-448",
"WNPRC-2018-456",
"WNPRC-2018-003",
"WNPRC-2018-071",
"WNPRC-2018-429",
"WNPRC-2018-437",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.238,b=1.401,cc=18.76,d=0.061),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng
  
#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G - Woolly 20181117 Plate 4 (Gwen and males)
E1G.20181117_4.gwen_males.samples<-ng.in.samples %>% mutate(file.name = "E1G - Woolly 20181117 Plate 4 (Gwen and males)") %>% mutate(hormone = "E1G")

E1G.20181117_4.gwen_males.pools<-ng.in.pools %>% mutate(file.name = "E1G - Woolly 20181117 Plate 4 (Gwen and males)") %>% mutate(hormone = "E1G")
```

#E1G Woolly 20181205 - Plate 1 (reruns 040-211)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181205 - Plate 1 (reruns 040-211).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-040-rerun1",
"WNPRC-2018-043-rerun1",
"WNPRC-2018-045-rerun1",
"WNPRC-2018-060-rerun1",
"WNPRC-2018-065-rerun1",
"WNPRC-2018-075-rerun1",
"WNPRC-2018-085-rerun1",
"WNPRC-2018-108-rerun1",
"WNPRC-2018-110-rerun1",
"WNPRC-2018-120-rerun1",
"WNPRC-2018-122-rerun1",
"WNPRC-2018-123-rerun1",
"WNPRC-2018-127-rerun1",
"WNPRC-2018-132-rerun1",
"WNPRC-2018-137-rerun1",
"WNPRC-2018-140-rerun1",
"WNPRC-2018-143-rerun1",
"WNPRC-2018-150-rerun1",
"WNPRC-2018-163-rerun1",
"WNPRC-2018-170-rerun1",
"WNPRC-2018-178-rerun1",
"WNPRC-2018-179-rerun1",
"WNPRC-2018-181-rerun1",
"WNPRC-2018-182-rerun1",
"WNPRC-2018-189-rerun1",
"WNPRC-2018-190-rerun1",
"WNPRC-2018-195-rerun1",
"WNPRC-2018-196-rerun1",
"WNPRC-2018-201-rerun1",
"WNPRC-2018-202-rerun1",
"WNPRC-2018-204-rerun1",
"WNPRC-2018-205-rerun1",
"WNPRC-2018-208-rerun1",
"WNPRC-2018-211-rerun1",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.048,b=1.580,cc=14.38,d=0.082),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G Woolly 20181205 - Plate 1 (reruns 040-211)
E1G.20181205_1.reruns040_211.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181205 - Plate 1 (reruns 040-211)") %>% mutate(hormone = "E1G")

E1G.20181205_1.reruns040_211.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181205 - Plate 1 (reruns 040-211)") %>% mutate(hormone = "E1G")
```

#E1G Woolly 20181205 - Plate 2 (reruns 213-297)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181205 - Plate 2 (reruns 213-297).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-213-rerun1",
"WNPRC-2018-216-rerun1",
"WNPRC-2018-217-rerun1",
"WNPRC-2018-218-rerun1",
"WNPRC-2018-219-rerun1",
"WNPRC-2018-221-rerun1",
"WNPRC-2018-222-rerun1",
"WNPRC-2018-223-rerun1",
"WNPRC-2018-224-rerun1",
"WNPRC-2018-231-rerun1",
"WNPRC-2018-232-rerun1",
"WNPRC-2018-235-rerun1",
"WNPRC-2018-237-rerun1",
"WNPRC-2018-239-rerun1",
"WNPRC-2018-240-rerun1",
"WNPRC-2018-244-rerun1",
"WNPRC-2018-246-rerun1",
"WNPRC-2018-252-rerun1",
"WNPRC-2018-256-rerun1",
"WNPRC-2018-257-rerun1",
"WNPRC-2018-260-rerun1",
"WNPRC-2018-263-rerun1",
"WNPRC-2018-265-rerun1",
"WNPRC-2018-267-rerun1",
"WNPRC-2018-273-rerun1",
"WNPRC-2018-276-rerun1",
"WNPRC-2018-280-rerun1",
"WNPRC-2018-281-rerun1",
"WNPRC-2018-284-rerun1",
"WNPRC-2018-285-rerun1",
"WNPRC-2018-286-rerun1",
"WNPRC-2018-287-rerun1",
"WNPRC-2018-293-rerun1",
"WNPRC-2018-297-rerun1",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.064,b=1.436,cc=16.15,d=0.061),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G Woolly 20181205 - Plate 2 (reruns 213-297)
E1G.20181205_2.reruns213_297.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181205 - Plate 2 (reruns 213-297)") %>% mutate(hormone = "E1G")

E1G.20181205_2.reruns213_297.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181205 - Plate 2 (reruns 213-297)") %>% mutate(hormone = "E1G")
```


#Reruns with diluted sample volume

For the last set of reruns, the volume used for each assay needs to be calculated differently given that the eluted sample was diluted before running the assay. Samples were diluted using methanol, which is the solvent in which samples were stored at in 2018. We used a dilution of either 1:10, 1:20, or 1:100. Therefore, for these runs, there is a third dilution factor that needs to be taken into account. However, it is also important to keep in mind that pools were not diluted.

1:10 -> 10uL of sample and 90uL of methanol (solvent in which samples were eluted in)
1:20 -> 10uL of sample and 190uL of methanol
1:100 -> 10uL of sample and 990uL of methanol


```{r}
vol.sample<-10 #enter the amount of uL that was taken from the original eluted sample

#divide the volume sample by the final volume after reconstituting the eluted sample with XXXuL of methanol

dil.1.10<-100/vol.sample
dil.1.20<-200/vol.sample
dil.1.100<-1000/vol.sample
```


#E1G Woolly 20181208 - Plate 1 (reruns 1.100)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181208 - Plate 1 (reruns 1.100).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-040-rerun2",
"WNPRC-2018-043-rerun2",
"WNPRC-2018-075-rerun2",
"WNPRC-2018-108-rerun2",
"WNPRC-2018-110-rerun2",
"WNPRC-2018-120-rerun2",
"WNPRC-2018-122-rerun2",
"WNPRC-2018-123-rerun2",
"WNPRC-2018-127-rerun2",
"WNPRC-2018-132-rerun2",
"WNPRC-2018-137-rerun2",
"WNPRC-2018-140-rerun2",
"WNPRC-2018-143-rerun2",
"WNPRC-2018-150-rerun2",
"WNPRC-2018-163-rerun2",
"WNPRC-2018-170-rerun2",
"WNPRC-2018-178-rerun2",
"WNPRC-2018-179-rerun2",
"WNPRC-2018-181-rerun2",
"WNPRC-2018-182-rerun2",
"WNPRC-2018-189-rerun2",
"WNPRC-2018-190-rerun2",
"WNPRC-2018-195-rerun2",
"WNPRC-2018-196-rerun2",
"WNPRC-2018-201-rerun2",
"WNPRC-2018-202-rerun2",
"WNPRC-2018-204-rerun2",
"WNPRC-2018-205-rerun2",
"WNPRC-2018-208-rerun2",
"WNPRC-2018-211-rerun2",
"WNPRC-2018-213-rerun2",
"WNPRC-2018-216-rerun2",
"WNPRC-2018-217-rerun2",
"WNPRC-2018-218-rerun2",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.112,b=1.339,cc=17.13,d=0.051),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 
dil3<-dil.1.100 # Dilution factor to account for the fact that we diluted 10uL of the original eluted sample with 990uL of methanol

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2*dil3)/1000) #dividing by 1000 to convert it from pg to ng


#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G Woolly 20181208 - Plate 1 (reruns 1.100)
E1G.20181208_1.reruns1.100.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181208 - Plate 1 (reruns 1.100)") %>% mutate(hormone = "E1G")

E1G.20181208_1.reruns1.100.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181208 - Plate 1 (reruns 1.100)") %>% mutate(hormone = "E1G")
```

#E1G Woolly 20181208 - Plate 2 (reruns 1.10)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181208 - Plate 2 (reruns 1.10).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-003-rerun2",
"WNPRC-2018-026-rerun2",
"WNPRC-2018-035-rerun2",
"WNPRC-2018-041-rerun2",
"WNPRC-2018-058-rerun2",
"WNPRC-2018-065-rerun2",
"WNPRC-2018-089-rerun2",
"WNPRC-2018-096-rerun2",
"WNPRC-2018-097-rerun2",
"WNPRC-2018-104-rerun2",
"WNPRC-2018-109-rerun2",
"WNPRC-2018-119-rerun2",
"WNPRC-2018-149-rerun2",
"WNPRC-2018-154-rerun2",
"WNPRC-2018-155-rerun2",
"WNPRC-2018-158-rerun2",
"WNPRC-2018-159-rerun2",
"WNPRC-2018-169-rerun2",
"WNPRC-2018-172-rerun2",
"WNPRC-2018-173-rerun2",
"WNPRC-2018-174-rerun2",
"WNPRC-2018-180-rerun2",
"WNPRC-2018-187-rerun2",
"WNPRC-2018-191-rerun2",
"WNPRC-2018-192-rerun2",
"WNPRC-2018-199-rerun2",
"WNPRC-2018-209-rerun2",
"WNPRC-2018-226-rerun2",
"WNPRC-2018-247-rerun2",
"WNPRC-2018-249-rerun2",
"WNPRC-2018-264-rerun2",
"WNPRC-2018-291-rerun2",
"WNPRC-2018-301-rerun2",
"WNPRC-2018-309-rerun2",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.100,b=1.371,cc=15.76,d=0.057),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 
dil3<-dil.1.10 # Dilution factor to account for the fact that we diluted 10uL of the original eluted sample with 990uL of methanol

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2*dil3)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR E1G Woolly 20181208 - Plate 2 (reruns 1.10)
E1G.20181208_2.reruns1.10.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181208 - Plate 2 (reruns 1.10)") %>% mutate(hormone = "E1G")

E1G.20181208_2.reruns1.10.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181208 - Plate 2 (reruns 1.10)") %>% mutate(hormone = "E1G")
```

#E1G Woolly 20181209 - Plate 1 (reruns 1.10)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181209 - Plate 1 (reruns 1.10).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-316-rerun3",
"WNPRC-2018-322-rerun3",
"WNPRC-2018-335-rerun3",
"WNPRC-2018-340-rerun3",
"WNPRC-2018-371-rerun3",
"WNPRC-2018-372-rerun3",
"WNPRC-2018-374-rerun3",
"WNPRC-2018-375-rerun3",
"WNPRC-2018-377-rerun3",
"WNPRC-2018-383-rerun3",
"WNPRC-2018-393-rerun3",
"WNPRC-2018-397-rerun3",
"WNPRC-2018-403-rerun3",
"WNPRC-2018-410-rerun3",
"WNPRC-2018-413-rerun3",
"WNPRC-2018-421-rerun3",
"WNPRC-2018-428-rerun3",
"WNPRC-2018-433-rerun3",
"WNPRC-2018-440-rerun3",
"WNPRC-2018-442-rerun3",
"WNPRC-2018-456-rerun3",
"WNPRC-2018-457-rerun3",
"Blank01-rerun3",
"Blank02-rerun3",
"Blank03-rerun3",
"Blank04-rerun3",
"Blank05-rerun3",
"Blank06-rerun3",
"Blank07-rerun3",
"Blank08-rerun3",
"Blank09-rerun3",
"Blank10-rerun3",
"Blank11-rerun3",
"Blank12-rerun3",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.273,b=1.308,cc=16.99,d=0.050),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 
dil3<-dil.1.10 # Dilution factor to account for the fact that we diluted 10uL of the original eluted sample with 990uL of methanol

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2*dil3)/1000) #dividing by 1000 to convert it from pg to ng


#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR E1G Woolly 20181209 - Plate 1 (reruns 1.10)
E1G.20181209_1.reruns1.10.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181209 - Plate 1 (reruns 1.10)") %>% mutate(hormone = "E1G")

E1G.20181209_1.reruns1.10.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181209 - Plate 1 (reruns 1.10)") %>% mutate(hormone = "E1G")
```

#E1G Woolly 20181209 - Plate 2 (reruns 1.20)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181209 - Plate 2 (reruns 1.20).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-040-rerun3",
"WNPRC-2018-043-rerun3",
"WNPRC-2018-075-rerun3",
"WNPRC-2018-108-rerun3",
"WNPRC-2018-110-rerun3",
"WNPRC-2018-120-rerun3",
"WNPRC-2018-122-rerun3",
"WNPRC-2018-123-rerun3",
"WNPRC-2018-127-rerun3",
"WNPRC-2018-132-rerun3",
"WNPRC-2018-137-rerun3",
"WNPRC-2018-140-rerun3",
"WNPRC-2018-143-rerun3",
"WNPRC-2018-150-rerun3",
"WNPRC-2018-163-rerun3",
"WNPRC-2018-170-rerun3",
"WNPRC-2018-178-rerun3",
"WNPRC-2018-179-rerun3",
"WNPRC-2018-181-rerun3",
"WNPRC-2018-182-rerun3",
"WNPRC-2018-189-rerun3",
"WNPRC-2018-190-rerun3",
"WNPRC-2018-195-rerun3",
"WNPRC-2018-196-rerun3",
"WNPRC-2018-201-rerun3",
"WNPRC-2018-203-rerun3",
"WNPRC-2018-204-rerun3",
"WNPRC-2018-205-rerun3",
"WNPRC-2018-208-rerun3",
"WNPRC-2018-211-rerun3",
"WNPRC-2018-213-rerun3",
"WNPRC-2018-216-rerun3",
"WNPRC-2018-217-rerun3",
"WNPRC-2018-218-rerun3",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.318,b=1.720,cc=19.94,d=0.093),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 
dil3<-dil.1.20 # Dilution factor to account for the fact that we diluted 10uL of the original eluted sample with 990uL of methanol

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2*dil3)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G Woolly 20181209 - Plate 2 (reruns 1.20)
E1G.20181209_2.reruns1.20.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181209 - Plate 2 (reruns 1.20)") %>% mutate(hormone = "E1G")

E1G.20181209_2.reruns1.20.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181209 - Plate 2 (reruns 1.20)") %>% mutate(hormone = "E1G")
```

#E1G Woolly 20181209 - Plate 3 (reruns 1.20)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181209 - Plate 3 (reruns 1.20).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-219-rerun3",
"WNPRC-2018-222-rerun3",
"WNPRC-2018-223-rerun3",
"WNPRC-2018-224-rerun3",
"WNPRC-2018-231-rerun3",
"WNPRC-2018-232-rerun3",
"WNPRC-2018-235-rerun3",
"WNPRC-2018-237-rerun3",
"WNPRC-2018-239-rerun3",
"WNPRC-2018-240-rerun3",
"WNPRC-2018-244-rerun3",
"WNPRC-2018-246-rerun3",
"WNPRC-2018-252-rerun3",
"WNPRC-2018-256-rerun3",
"WNPRC-2018-257-rerun3",
"WNPRC-2018-259-rerun3",
"WNPRC-2018-260-rerun3",
"WNPRC-2018-263-rerun3",
"WNPRC-2018-265-rerun3",
"WNPRC-2018-267-rerun3",
"WNPRC-2018-273-rerun3",
"WNPRC-2018-276-rerun3",
"WNPRC-2018-277-rerun3",
"WNPRC-2018-280-rerun3",
"WNPRC-2018-281-rerun3",
"WNPRC-2018-283-rerun3",
"WNPRC-2018-284-rerun3",
"WNPRC-2018-285-rerun3",
"WNPRC-2018-286-rerun3",
"WNPRC-2018-287-rerun3",
"WNPRC-2018-293-rerun3",
"WNPRC-2018-297-rerun3",
"WNPRC-2018-298-rerun3",
"WNPRC-2018-300-rerun3",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.062,b=1.436,cc=15.53,d=0.068),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 
dil3<-dil.1.20 # Dilution factor to account for the fact that we diluted 10uL of the original eluted sample with 990uL of methanol

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2*dil3)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G Woolly 20181209 - Plate 3 (reruns 1.20)
E1G.20181209_3.reruns1.20.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181209 - Plate 3 (reruns 1.20)") %>% mutate(hormone = "E1G")

E1G.20181209_3.reruns1.20.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181209 - Plate 3 (reruns 1.20)") %>% mutate(hormone = "E1G")
```

#E1G Woolly 20181209 - Plate 4 (reruns 1.20)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181209 - Plate 4 (reruns 1.20).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-307-rerun3",
"WNPRC-2018-310-rerun3",
"WNPRC-2018-311-rerun3",
"WNPRC-2018-312-rerun3",
"WNPRC-2018-313-rerun3",
"WNPRC-2018-314-rerun3",
"WNPRC-2018-315-rerun3",
"WNPRC-2018-317-rerun3",
"WNPRC-2018-318-rerun3",
"WNPRC-2018-319-rerun3",
"WNPRC-2018-320-rerun3",
"WNPRC-2018-324-rerun3",
"WNPRC-2018-325-rerun3",
"WNPRC-2018-327-rerun3",
"WNPRC-2018-328-rerun3",
"WNPRC-2018-330-rerun3",
"WNPRC-2018-331-rerun3",
"WNPRC-2018-332-rerun3",
"WNPRC-2018-333-rerun3",
"WNPRC-2018-334-rerun3",
"WNPRC-2018-336-rerun3",
"WNPRC-2018-337-rerun3",
"WNPRC-2018-338-rerun3",
"WNPRC-2018-339-rerun3",
"WNPRC-2018-341-rerun3",
"WNPRC-2018-342-rerun3",
"WNPRC-2018-343-rerun3",
"WNPRC-2018-345-rerun3",
"WNPRC-2018-346-rerun3",
"WNPRC-2018-347-rerun3",
"WNPRC-2018-348-rerun3",
"WNPRC-2018-349-rerun3",
"WNPRC-2018-350-rerun3",
"WNPRC-2018-351-rerun3",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.204,b=1.145,cc=13.55,d=0.041),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 
dil3<-dil.1.20 # Dilution factor to account for the fact that we diluted 10uL of the original eluted sample with 990uL of methanol

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2*dil3)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G Woolly 20181209 - Plate 4 (reruns 1.20)
E1G.20181209_4.reruns1.20.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181209 - Plate 4 (reruns 1.20)") %>% mutate(hormone = "E1G")

E1G.20181209_4.reruns1.20.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181209 - Plate 4 (reruns 1.20)") %>% mutate(hormone = "E1G")
```

#E1G Woolly 20181209 - Plate 5 (reruns 1.20)

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181209 - Plate 5 (reruns 1.20).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-352-rerun3",
"WNPRC-2018-354-rerun3",
"WNPRC-2018-355-rerun3",
"WNPRC-2018-356-rerun3",
"WNPRC-2018-357-rerun3",
"WNPRC-2018-359-rerun3",
"WNPRC-2018-360-rerun3",
"WNPRC-2018-362-rerun3",
"WNPRC-2018-363-rerun3",
"WNPRC-2018-365-rerun3",
"WNPRC-2018-366-rerun3",
"WNPRC-2018-369-rerun3",
"WNPRC-2018-370-rerun3",
"WNPRC-2018-376-rerun3",
"WNPRC-2018-378-rerun3",
"WNPRC-2018-379-rerun3",
"WNPRC-2018-380-rerun3",
"WNPRC-2018-381-rerun3",
"WNPRC-2018-384-rerun3",
"WNPRC-2018-386-rerun3",
"WNPRC-2018-387-rerun3",
"WNPRC-2018-388-rerun3",
"WNPRC-2018-389-rerun3",
"WNPRC-2018-391-rerun3",
"WNPRC-2018-394-rerun3",
"WNPRC-2018-396-rerun3",
"WNPRC-2018-398-rerun3",
"WNPRC-2018-399-rerun3",
"WNPRC-2018-401-rerun3",
"WNPRC-2018-404-rerun3",
"WNPRC-2018-405-rerun3",
"WNPRC-2018-407-rerun3",
"WNPRC-2018-408-rerun3",
"WNPRC-2018-411-rerun3",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.171,b=1.234,cc=13.16,d=0.053),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 
dil3<-dil.1.20 # Dilution factor to account for the fact that we diluted 10uL of the original eluted sample with 990uL of methanol

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2*dil3)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 

#FINAL TABLES FOR E1G Woolly 20181209 - Plate 5 (reruns 1.20)
E1G.20181209_5.reruns1.20.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181209 - Plate 5 (reruns 1.20)") %>% mutate(hormone = "E1G")

E1G.20181209_5.reruns1.20.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181209 - Plate 5 (reruns 1.20)") %>% mutate(hormone = "E1G")
```

#E1G Woolly 20181209 - Plate 6 (reruns 1.20)
For this run there was not enough of standard #4 so we decided to keep the general parameters used for the test plate. Maybe remove stardard #4 from the standard curve for more accurate results? 

```{r}
e1g.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/E1G Woolly 20181209 - Plate 6 (reruns 1.20).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(e1g.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(e1g.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U13","U23","U01","Z01","U14","U24","U02","S01","U15","U25","U03","S02","U16","U26","U04","S03","U17","U27","U05","S04","C01","U28","U06","S05","C02","U29","U07","S06","U18","U30","U08","S07","U19","U31","U09","S08","U20","U32","U10","Z02","U21","U33","U11","U12","U22","U34"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06","S07","S08",
"WNPRC-2018-412-rerun3",
"WNPRC-2018-416-rerun3",
"WNPRC-2018-418-rerun3",
"WNPRC-2018-420-rerun3",
"WNPRC-2018-423-rerun3",
"WNPRC-2018-425-rerun3",
"WNPRC-2018-427-rerun3",
"WNPRC-2018-430-rerun3",
"WNPRC-2018-431-rerun3",
"WNPRC-2018-435-rerun3",
"WNPRC-2018-437-rerun3",
"WNPRC-2018-438-rerun3",
"WNPRC-2018-439-rerun3",
"WNPRC-2018-441-rerun3",
"WNPRC-2018-443-rerun3",
"WNPRC-2018-444-rerun3",
"WNPRC-2018-446-rerun3",
"WNPRC-2018-447-rerun3",
"WNPRC-2018-448-rerun3",
"WNPRC-2018-449-rerun3",
"WNPRC-2018-450-rerun3",
"WNPRC-2018-453-rerun3",
"WNPRC-2018-454-rerun3",
"WNPRC-2018-459-rerun3",
"Blank01-rerun4",
"Blank02-rerun4",
"Blank03-rerun4",
"Blank04-rerun4",
"Blank05-rerun4",
"Blank06-rerun4",
"Blank07-rerun4",
"Blank08-rerun4",
"Blank09-rerun4",
"Blank10-rerun4",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06","S07","S08")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(1.953,3.906,7.813,15.625,31.25,62.5,125,250)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=1.036,b=1.733,cc=20.47,d=0.074)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.064,b=1.436,cc=16.15,d=0.061),data=std.curve) 


# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","S07","S08","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-10 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 
dil3<-dil.1.20 # Dilution factor to account for the fact that we diluted 10uL of the original eluted sample with 990uL of methanol

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","S07","S08","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2*dil3)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-10 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR E1G Woolly 20181209 - Plate 6 (reruns 1.20)
E1G.20181209_6.reruns1.20.samples<-ng.in.samples %>% mutate(file.name = "E1G Woolly 20181209 - Plate 6 (reruns 1.20)") %>% mutate(hormone = "E1G")

E1G.20181209_6.reruns1.20.pools<-ng.in.pools %>% mutate(file.name = "E1G Woolly 20181209 - Plate 6 (reruns 1.20)") %>% mutate(hormone = "E1G")
```



# PdG 2018 samples:
PdG standard values:

#PdG Woolly 20181101 - Plate 1 (PoolsPlate)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181101 - Plate 1 (PoolsPlate).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
#data<-read.table(pdg.file.name, skip = 19, header = TRUE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
                     "WNPRC-2018-001",
                     "WNPRC-2018-006",
                     "WNPRC-2018-050",
                     "WNPRC-2018-107",
                     "WNPRC-2018-141",
                     "WNPRC-2018-149",
                     "WNPRC-2018-318",
                     "WNPRC-2018-320",
                     "WNPRC-2018-337",
                     "WNPRC-2018-339",
                     "WNPRC-2018-342",
                     "WNPRC-2018-348",
                     "WNPRC-2018-353",
                     "WNPRC-2018-403",
                     "WNPRC-2018-409",
                     "WNPRC-2018-410",
                     "WNPRC-2018-418",
                     "WNPRC-2018-450",
                     "WNPRC-2018-028",
                     "WNPRC-2018-038",
                     "WNPRC-2018-042",
                     "WNPRC-2018-378",
                     "WNPRC-2018-394",
                     "WNPRC-2018-411",
                     "WNPRC-2018-414",
                     "WNPRC-2018-416",
                     "WNPRC-2018-419",
                     "WNPRC-2018-425",
                     "WNPRC-2018-430",
                     "WNPRC-2018-431",
                     "WNPRC-2018-438",
                     "WNPRC-2018-439",
                     "WNPRC-2018-446",
                     "WNPRC-2018-447",
                     "WNPRC-2018-449",
                     "WNPRC-2018-451",
                     "Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.936,b=0.979,cc=538.2,d=0.027),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181101 - Plate 1 (PoolsPlate)
PdG.20181101.testplate.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181101 - Plate 1 (PoolsPlate)") %>% mutate(hormone = "PdG")

PdG.20181101.testplate.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181101 - Plate 1 (PoolsPlate)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181103 - Plate 1 (Cali)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181103 - Plate 1 (Cali).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 19, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 19, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-004",
"WNPRC-2018-007",
"WNPRC-2018-015",
"WNPRC-2018-019",
"WNPRC-2018-026",
"WNPRC-2018-035",
"WNPRC-2018-039",
"WNPRC-2018-046",
"WNPRC-2018-069",
"WNPRC-2018-077",
"WNPRC-2018-082",
"WNPRC-2018-087",
"WNPRC-2018-096",
"WNPRC-2018-102",
"WNPRC-2018-108",
"WNPRC-2018-135",
"WNPRC-2018-152",
"WNPRC-2018-163",
"WNPRC-2018-172",
"WNPRC-2018-175",
"WNPRC-2018-183",
"WNPRC-2018-194",
"WNPRC-2018-205",
"WNPRC-2018-222",
"WNPRC-2018-231",
"WNPRC-2018-232",
"WNPRC-2018-239",
"WNPRC-2018-244",
"WNPRC-2018-256",
"WNPRC-2018-257",
"WNPRC-2018-263",
"WNPRC-2018-270",
"WNPRC-2018-280",
"WNPRC-2018-287",
"WNPRC-2018-298",
"WNPRC-2018-314",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.927,b=0.846,cc=470.3,d=0.011),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181103 - Plate 1 (Cali)
PdG.20181103_1.cali.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181103 - Plate 1 (Cali)") %>% mutate(hormone = "PdG")

PdG.20181103_1.cali.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181103 - Plate 1 (Cali)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181103 - Plate 2 (Cali and Chai)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181103 - Plate 2 (Cali and Chai).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 19, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-317",
"WNPRC-2018-330",
"WNPRC-2018-332",
"WNPRC-2018-347",
"WNPRC-2018-354",
"WNPRC-2018-362",
"WNPRC-2018-389",
"WNPRC-2018-408",
"WNPRC-2018-415",
"WNPRC-2018-441",
"WNPRC-2018-011",
"WNPRC-2018-018",
"WNPRC-2018-022",
"WNPRC-2018-034",
"WNPRC-2018-048",
"WNPRC-2018-061",
"WNPRC-2018-063",
"WNPRC-2018-067",
"WNPRC-2018-073",
"WNPRC-2018-088",
"WNPRC-2018-095",
"WNPRC-2018-099",
"WNPRC-2018-106",
"WNPRC-2018-109",
"WNPRC-2018-116",
"WNPRC-2018-125",
"WNPRC-2018-129",
"WNPRC-2018-133",
"WNPRC-2018-143",
"WNPRC-2018-146",
"WNPRC-2018-153",
"WNPRC-2018-162",
"WNPRC-2018-166",
"WNPRC-2018-176",
"WNPRC-2018-187",
"WNPRC-2018-191",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.874,b=1.002,cc=509.3,d=0.038),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181103 - Plate 2 (Cali and Chai)
PdG.20181103_2.cali_chai.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181103 - Plate 2 (Cali and Chai)") %>% mutate(hormone = "PdG")

PdG.20181103_2.cali_chai.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181103 - Plate 2 (Cali and Chai)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181104 - Plate 1 (Chai and Papaya)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181104 - Plate 1 (Chai and Papaya).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-199",
"WNPRC-2018-202",
"WNPRC-2018-204",
"WNPRC-2018-211",
"WNPRC-2018-220",
"WNPRC-2018-234",
"WNPRC-2018-238",
"WNPRC-2018-242",
"WNPRC-2018-245",
"WNPRC-2018-254",
"WNPRC-2018-262",
"WNPRC-2018-272",
"WNPRC-2018-275",
"WNPRC-2018-288",
"WNPRC-2018-299",
"WNPRC-2018-305",
"WNPRC-2018-310",
"WNPRC-2018-315",
"WNPRC-2018-325",
"WNPRC-2018-333",
"WNPRC-2018-351",
"WNPRC-2018-361",
"WNPRC-2018-363",
"WNPRC-2018-379",
"WNPRC-2018-396",
"WNPRC-2018-404",
"WNPRC-2018-134",
"WNPRC-2018-139",
"WNPRC-2018-147",
"WNPRC-2018-155",
"WNPRC-2018-158",
"WNPRC-2018-168",
"WNPRC-2018-180",
"WNPRC-2018-186",
"WNPRC-2018-200",
"WNPRC-2018-210",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.948,b=0.894,cc=520.6,d=0.014),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181104 - Plate 1 (Chai and Papaya)
PdG.20181104_1.chai_papaya.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181104 - Plate 1 (Chai and Papaya)") %>% mutate(hormone = "PdG")

PdG.20181104_1.chai_papaya.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181104 - Plate 1 (Chai and Papaya)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181104 - Plate 2 (Papaya and Poquer)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181104 - Plate 2 (Papaya and Poquer).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 19, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-212",
"WNPRC-2018-219",
"WNPRC-2018-229",
"WNPRC-2018-241",
"WNPRC-2018-249",
"WNPRC-2018-253",
"WNPRC-2018-264",
"WNPRC-2018-273",
"WNPRC-2018-278",
"WNPRC-2018-281",
"WNPRC-2018-286",
"WNPRC-2018-291",
"WNPRC-2018-301",
"WNPRC-2018-313",
"WNPRC-2018-324",
"WNPRC-2018-334",
"WNPRC-2018-340",
"WNPRC-2018-345",
"WNPRC-2018-357",
"WNPRC-2018-360",
"WNPRC-2018-369",
"WNPRC-2018-384",
"WNPRC-2018-388",
"WNPRC-2018-393",
"WNPRC-2018-398",
"WNPRC-2018-405",
"WNPRC-2018-413",
"WNPRC-2018-032",
"WNPRC-2018-040",
"WNPRC-2018-043",
"WNPRC-2018-058",
"WNPRC-2018-070",
"WNPRC-2018-072",
"WNPRC-2018-080",
"WNPRC-2018-101",
"WNPRC-2018-105",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.899,b=0.877,cc=518.0,d=0.008),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181104 - Plate 2 (Papaya and Poquer)
PdG.20181104_2.papaya_poquer.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181104 - Plate 2 (Papaya and Poquer)") %>% mutate(hormone = "PdG")

PdG.20181104_2.papaya_poquer.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181104 - Plate 2 (Papaya and Poquer)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181104 - Plate 3 (Poquer)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181104 - Plate 3 (Poquer).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 19, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-119",
"WNPRC-2018-120",
"WNPRC-2018-123",
"WNPRC-2018-131",
"WNPRC-2018-140",
"WNPRC-2018-145",
"WNPRC-2018-157",
"WNPRC-2018-167",
"WNPRC-2018-170",
"WNPRC-2018-178",
"WNPRC-2018-189",
"WNPRC-2018-196",
"WNPRC-2018-201",
"WNPRC-2018-209",
"WNPRC-2018-221",
"WNPRC-2018-228",
"WNPRC-2018-237",
"WNPRC-2018-246",
"WNPRC-2018-259",
"WNPRC-2018-266",
"WNPRC-2018-267",
"WNPRC-2018-277",
"WNPRC-2018-283",
"WNPRC-2018-294",
"WNPRC-2018-302",
"WNPRC-2018-308",
"WNPRC-2018-311",
"WNPRC-2018-322",
"WNPRC-2018-336",
"WNPRC-2018-346",
"WNPRC-2018-358",
"WNPRC-2018-374",
"WNPRC-2018-386",
"WNPRC-2018-392",
"WNPRC-2018-397",
"WNPRC-2018-422",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.898,b=0.914,cc=437.8,d=0.028),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181104 - Plate 3 (Poquer)
PdG.20181104_3.poquer.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181104 - Plate 3 (Poquer)") %>% mutate(hormone = "PdG")

PdG.20181104_3.poquer.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181104 - Plate 3 (Poquer)") %>% mutate(hormone = "PdG")
```




#PdG Woolly 20181105 - Plate 1 (Poquer and Pepa)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181105 - Plate 1 (Poquer and Pepa).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-426",
"WNPRC-2018-428",
"WNPRC-2018-433",
"WNPRC-2018-453",
"WNPRC-2018-045",
"WNPRC-2018-053",
"WNPRC-2018-060",
"WNPRC-2018-065",
"WNPRC-2018-085",
"WNPRC-2018-089",
"WNPRC-2018-104",
"WNPRC-2018-122",
"WNPRC-2018-132",
"WNPRC-2018-137",
"WNPRC-2018-148",
"WNPRC-2018-154",
"WNPRC-2018-171",
"WNPRC-2018-181",
"WNPRC-2018-190",
"WNPRC-2018-195",
"WNPRC-2018-213",
"WNPRC-2018-217",
"WNPRC-2018-224",
"WNPRC-2018-230",
"WNPRC-2018-240",
"WNPRC-2018-252",
"WNPRC-2018-268",
"WNPRC-2018-284",
"WNPRC-2018-285",
"WNPRC-2018-293",
"WNPRC-2018-297",
"WNPRC-2018-300",
"WNPRC-2018-312",
"WNPRC-2018-323",
"WNPRC-2018-341",
"WNPRC-2018-356",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.936,b=0.979,cc=538.2,d=0.027),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181105 - Plate 1 (Poquer and Pepa)
PdG.20181105_1.poquer_pepa.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181105 - Plate 1 (Poquer and Pepa)") %>% mutate(hormone = "PdG")

PdG.20181105_1.poquer_pepa.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181105 - Plate 1 (Poquer and Pepa)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181105 - Plate 2 (Pepa and Policarpa)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181105 - Plate 2 (Pepa and Policarpa).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-359",
"WNPRC-2018-368",
"WNPRC-2018-376",
"WNPRC-2018-383",
"WNPRC-2018-387",
"WNPRC-2018-391",
"WNPRC-2018-420",
"WNPRC-2018-427",
"WNPRC-2018-443",
"WNPRC-2018-457",
"WNPRC-2018-460",
"WNPRC-2018-047",
"WNPRC-2018-081",
"WNPRC-2018-117",
"WNPRC-2018-124",
"WNPRC-2018-136",
"WNPRC-2018-144",
"WNPRC-2018-159",
"WNPRC-2018-169",
"WNPRC-2018-179",
"WNPRC-2018-188",
"WNPRC-2018-197",
"WNPRC-2018-208",
"WNPRC-2018-218",
"WNPRC-2018-223",
"WNPRC-2018-227",
"WNPRC-2018-236",
"WNPRC-2018-247",
"WNPRC-2018-260",
"WNPRC-2018-271",
"WNPRC-2018-292",
"WNPRC-2018-296",
"WNPRC-2018-307",
"WNPRC-2018-321",
"WNPRC-2018-331",
"WNPRC-2018-344",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.962,b=0.867,cc=534.0,d=0.003),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181105 - Plate 2 (Pepa and Policarpa)
PdG.20181105_2.pepa_policarpa.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181105 - Plate 2 (Pepa and Policarpa)") %>% mutate(hormone = "PdG")

PdG.20181105_2.pepa_policarpa.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181105 - Plate 2 (Pepa and Policarpa)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181108 - Plate 1 (Policarpa, Papaya and Cuenca)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181108 - Plate 1 (Policarpa, Papaya and Cuenca).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-365",
"WNPRC-2018-370",
"WNPRC-2018-371",
"WNPRC-2018-372",
"WNPRC-2018-382",
"WNPRC-2018-385",
"WNPRC-2018-402",
"WNPRC-2018-424",
"WNPRC-2018-442",
"WNPRC-2018-452",
"WNPRC-2018-455",
"WNPRC-2018-458",
"WNPRC-2018-020",
"WNPRC-2018-037",
"WNPRC-2018-041",
"WNPRC-2018-044",
"WNPRC-2018-049",
"WNPRC-2018-059",
"WNPRC-2018-062",
"WNPRC-2018-074",
"WNPRC-2018-083",
"WNPRC-2018-092",
"WNPRC-2018-097",
"WNPRC-2018-115",
"WNPRC-2018-121",
"WNPRC-2018-009",
"WNPRC-2018-012",
"WNPRC-2018-014",
"WNPRC-2018-017",
"WNPRC-2018-023",
"WNPRC-2018-030",
"WNPRC-2018-056",
"WNPRC-2018-066",
"WNPRC-2018-078",
"WNPRC-2018-079",
"WNPRC-2018-086",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.970,b=1.012,cc=445.9,d=0.060),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181108 - Plate 1 (Policarpa, Papaya and Cuenca)
PdG.20181108_1.policarpa_papaya_cuenca.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181108 - Plate 1 (Policarpa, Papaya and Cuenca)") %>% mutate(hormone = "PdG")

PdG.20181108_1.policarpa_papaya_cuenca.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181108 - Plate 1 (Policarpa, Papaya and Cuenca)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181108 - Plate 2 (Cuenca and Der)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181108 - Plate 2 (Cuenca and Der).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-094",
"WNPRC-2018-100",
"WNPRC-2018-111",
"WNPRC-2018-114",
"WNPRC-2018-002",
"WNPRC-2018-010",
"WNPRC-2018-016",
"WNPRC-2018-025",
"WNPRC-2018-052",
"WNPRC-2018-057",
"WNPRC-2018-075",
"WNPRC-2018-090",
"WNPRC-2018-093",
"WNPRC-2018-103",
"WNPRC-2018-127",
"WNPRC-2018-138",
"WNPRC-2018-150",
"WNPRC-2018-156",
"WNPRC-2018-173",
"WNPRC-2018-174",
"WNPRC-2018-182",
"WNPRC-2018-192",
"WNPRC-2018-207",
"WNPRC-2018-216",
"WNPRC-2018-226",
"WNPRC-2018-235",
"WNPRC-2018-248",
"WNPRC-2018-255",
"WNPRC-2018-265",
"WNPRC-2018-276",
"WNPRC-2018-279",
"WNPRC-2018-290",
"WNPRC-2018-303",
"WNPRC-2018-304",
"WNPRC-2018-319",
"WNPRC-2018-327",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.951,b=1.070,cc=534.0,d=0.049),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181108 - Plate 2 (Cuenca and Der)
PdG.20181108_2.cuenca_der.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181108 - Plate 2 (Cuenca and Der)") %>% mutate(hormone = "PdG")

PdG.20181108_2.cuenca_der.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181108 - Plate 2 (Cuenca and Der)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181113 - Plate 1 (Der and Gwen)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181113 - Plate 1 (Der and Gwen).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-091",
"WNPRC-2018-110",
"WNPRC-2018-215",
"WNPRC-2018-328",
"WNPRC-2018-338",
"WNPRC-2018-343",
"WNPRC-2018-355",
"WNPRC-2018-366",
"WNPRC-2018-380",
"WNPRC-2018-381",
"WNPRC-2018-401",
"WNPRC-2018-412",
"WNPRC-2018-423",
"WNPRC-2018-435",
"WNPRC-2018-444",
"WNPRC-2018-454",
"WNPRC-2018-459",
"WNPRC-2018-005",
"WNPRC-2018-008",
"WNPRC-2018-021",
"WNPRC-2018-027",
"WNPRC-2018-033",
"WNPRC-2018-055",
"WNPRC-2018-064",
"WNPRC-2018-068",
"WNPRC-2018-076",
"WNPRC-2018-084",
"WNPRC-2018-098",
"WNPRC-2018-112",
"WNPRC-2018-113",
"WNPRC-2018-126",
"WNPRC-2018-130",
"WNPRC-2018-142",
"WNPRC-2018-151",
"WNPRC-2018-160",
"WNPRC-2018-161",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.957,b=1.127,cc=595.0,d=0.056),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181113 - Plate 1 (Der and Gwen)
PdG.20181113_1.der_gwen.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181113 - Plate 1 (Der and Gwen)") %>% mutate(hormone = "PdG")

PdG.20181103_1.der_gwen.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181113 - Plate 1 (Der and Gwen)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181113 - Plate 2 (Gwen)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181113 - Plate 2 (Gwen).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-164",
"WNPRC-2018-165",
"WNPRC-2018-177",
"WNPRC-2018-184",
"WNPRC-2018-185",
"WNPRC-2018-193",
"WNPRC-2018-198",
"WNPRC-2018-203",
"WNPRC-2018-206",
"WNPRC-2018-214",
"WNPRC-2018-225",
"WNPRC-2018-233",
"WNPRC-2018-243",
"WNPRC-2018-250",
"WNPRC-2018-251",
"WNPRC-2018-258",
"WNPRC-2018-261",
"WNPRC-2018-269",
"WNPRC-2018-274",
"WNPRC-2018-282",
"WNPRC-2018-289",
"WNPRC-2018-295",
"WNPRC-2018-306",
"WNPRC-2018-309",
"WNPRC-2018-316",
"WNPRC-2018-326",
"WNPRC-2018-335",
"WNPRC-2018-349",
"WNPRC-2018-350",
"WNPRC-2018-352",
"WNPRC-2018-364",
"WNPRC-2018-367",
"WNPRC-2018-373",
"WNPRC-2018-375",
"WNPRC-2018-377",
"WNPRC-2018-395",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=0.965,b=0.979,cc=515.2,d=0.038),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181113 - Plate 2 (Gwen)
PdG.20181113_2.gwen.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181113 - Plate 2 (Gwen)") %>% mutate(hormone = "PdG")

PdG.20181103_2.gwen.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181113 - Plate 2 (Gwen)") %>% mutate(hormone = "PdG")
```

#PdG Woolly 20181113 - Plate 3 (Gwen and others)

```{r}
pdg.file.name<-'~/Box Sync/UT Box Sync/UT-Austin/DISSERTATION/Dissertation_R/Hormones_R/Diss_Hormones_R/WNPRCSoftmax2018/PdG Woolly 20181113 - Plate 3 (Gwen and others).txt'

# May need to modify the skip value according to the exported output from SoftmaxPro
#data<-read.table(pdg.file.name, skip = 20, header = FALSE, nrows = 8) 

# If above code doesn't work, try specifying the fileEncoding (uncomment the following line of code):
data<-read.table(pdg.file.name, skip = 18, header = FALSE, nrows = 8, fileEncoding = "UCS-2LE") 

data<-unlist(data,use.names=F) 

ids<-c(rep(c("N","N","U15","U25","U01","Z01","U16","U26","U02","S01","U17","U27","U03","S02","U18","U28","U04","S03","U19","U29","U05","S04","C01","U30","U06","S05","C02","U31","U07","S06","U20","U32","U08","Z02","U21","U33","U09","U12","U22","U34","U10","U13","U23","U35","U11","U14","U24","U36"),each=2))

#put the IDs and the data together
work<-data.frame(ids,cod=data)

#sort data frame by ids
work<-work[order(ids),]

sample.name<-c(rep(c("C01","C02","N","N","S01","S02","S03","S04","S05","S06",
"WNPRC-2018-399",
"WNPRC-2018-407",
"WNPRC-2018-421",
"WNPRC-2018-432",
"WNPRC-2018-440",
"WNPRC-2018-445",
"WNPRC-2018-448",
"WNPRC-2018-456",
"WNPRC-2018-003",
"WNPRC-2018-013",
"WNPRC-2018-024",
"WNPRC-2018-029",
"WNPRC-2018-031",
"WNPRC-2018-036",
"WNPRC-2018-051",
"WNPRC-2018-054",
"WNPRC-2018-071",
"WNPRC-2018-329",
"WNPRC-2018-390",
"WNPRC-2018-400",
"WNPRC-2018-406",
"WNPRC-2018-417",
"WNPRC-2018-429",
"WNPRC-2018-434",
"WNPRC-2018-436",
"WNPRC-2018-437",
"WNPRC-2018-019",
"Blank01-pdg",
"Blank02-pdg",
"Blank03-pdg",
"Blank04-pdg",
"Blank05-pdg",
"Blank06-pdg",
"Blank07-pdg",
"Blank08-pdg",
"Blank09-pdg",
"Z01","Z02"),each=2))

# Add sample names to data frame
work<-cbind(work,sample.name)
work<-work[,c("ids","sample.name","cod")]


# Calculating the mean
work2 <-
  group_by(work,sample.name)%>%
  summarise(meanod=mean(cod),
            stdev = sd(cod)) %>%
  mutate(cv=(stdev/meanod)*100)

# select out blank 
blank<-unlist(select(filter(work2,sample.name == "N"),meanod),use.names=F)

#subtract the blank from all wells gives you netod
work3<-mutate(work2, netod = meanod - blank)

# select out your maximum binding values (labelled as Z) 
BO<-unlist(select(filter(work3,sample.name %in% c("Z01","Z02")),netod),use.names=F) %>% mean(.)

# Calculate percent binding
work4<-mutate(work3,bound=(netod/BO)*100) 

# Filter out standards to make standard curve
std.curve<-
  filter(work4,sample.name %in% c("S01","S02","S03","S04","S05","S06")) %>%
  select(sample.name,netod) %>%
  mutate(econ = (c(25,79.05,250,790.5,2500,7905)))


std.plot<-ggplot(std.curve, aes(x=econ,y=netod)) + coord_trans(x="log") + geom_point(data=std.curve,size=4,col='red')

#Make the non-linear fit
#Need to provide some estimates for A,B,C,D (estimates taken from Softmax Pro 7.0): (a=0.936,b=0.979,cc=538.2,d=0.027)

model=nlsLM(netod ~ d+(a-d)/(1+(econ/cc)^b),start=list(a=1.006,b=0.930,cc=523.6,d=0.041),data=std.curve) 

# plot the non-linear model 
min1<-min(std.curve$econ)
max1<-max(std.curve$econ)
model.pred<-data.frame(netod=predict(model,newdata=data.frame(econ=seq(min1,max1,by=.1))),econ=seq(min1,max1,by=.1))
fit<-1-(deviance(model)/sum((std.curve$netod-mean(std.curve$netod))^2))

final.plot<-std.plot +geom_line(data=model.pred, aes(x=econ,y=netod))
#final.plot

#just a helper function does the opposite of '%in%
'%!in%' <- function(x,y)!('%in%'(x,y))

# To find pg/tube based on the standard curve:
# In this chunk of code we are selecting all samples that ARE NOT the standards, control pools, or zeros. 
final.nonlinear.samples<-
  filter(work4,sample.name %!in% c("N","S01","S02","S03","S04","S05","S06","C01","C02","Z01","Z02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Calculating concentrations in ng/g
#Required data:
vol1<-5 #enter the volume used in the feces-solvent mix (in mL)
vol2<-2 #enter the amount of volume pushed through SPE (in mL)
vol3<-2000 #enter the volume in which sample was eluted/reconstituted (in uL)
vol4<-5 #enter the volume used in assay (in uL)


# Dilutions:
dil1<-vol1/vol2 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces
dil2<-vol3/vol4 # Dilution factor to account for the volume of sample used in assay 

# Convert to ng/g:
ng.in.samples<- 
  filter(final.nonlinear.samples,sample.name %!in% c("C01","C02","S01","S02","S03","S04","S05","S06","Z01","Z02")) %>% 
  mutate(ng.per.sample = (pg.per.tube*dil1*dil2)/1000) #dividing by 1000 to convert it from pg to ng

#Calculating ng/g for high and low pools:

final.nonlinear.pools<-
  filter(work4,sample.name %in% c("C01","C02")) %>% mutate(pg.per.tube = coef(model)["cc"]*(((-1*coef(model)["a"]+netod)/(coef(model)["d"]-netod))^(1/coef(model)["b"])))

#Required data:
pool.vol1<-1000 #enter the volume in which sample was eluted/reconstituted (in uL)
pool.vol2<-5 #enter the volume used in assay (in uL)

# Pool Dilutions:
pool.dil1<-dil1 # Dilution factor for percent of sample used from the original 5ml of solvent mixed with feces. Should be the sample for pools as it is for samples. 
pool.dil2<-pool.vol1/pool.vol2 # Dilution factor to account for the volume of sample used in assay 

# Low and High pools in ng/g:
ng.in.pools<- filter(final.nonlinear.pools,sample.name %in% c("C01","C02")) %>% 
  mutate(ng.per.gram.pool = (pg.per.tube*pool.dil1*pool.dil2)/1000) 


#FINAL TABLES FOR PdG Woolly 20181113 - Plate 3 (Gwen and others)
PdG.20181113_3.gwen_others.samples<-ng.in.samples %>% mutate(file.name = "PdG Woolly 20181113 - Plate 3 (Gwen and others)") %>% mutate(hormone = "PdG")

PdG.20181103_3.gwen_others.pools<-ng.in.pools %>% mutate(file.name = "PdG Woolly 20181113 - Plate 3 (Gwen and others)") %>% mutate(hormone = "PdG")
```



# FINAL TABLES: Merging all output files into a single data frame
The last step is to merge all of the data grame output files into a single one for easier analysis. Will create two different data frames for each hormone: one for the actual sample values, and another one for the pool values. 

1. Data frame for sample values

```{r}
FINAL.E1G.2018.samples<- rbind(
  E1G.20181101.testplate.samples,
  E1G.20181115_1.cali.samples,
  E1G.20181115_2.cali_chai.samples,
  E1G.20181115_3.chai_papaya.samples,
  E1G.20181115_4.papaya.samples,
  E1G.20181116_1.papaya_poquer.samples,
  E1G.20181116_2.poquer_pepa.samples,
  E1G.20181116_3.pepa.samples,
  E1G.20181116_4.policarpa.samples,
  E1G.20181117_1.policarpa_cuenca_der.samples,
  E1G.20181117_2.der.samples,
  E1G.20181117_3.der_gwen.samples,
  E1G.20181117_4.gwen_males.samples,
  E1G.20181205_1.reruns040_211.samples,
  E1G.20181205_2.reruns213_297.samples,
  E1G.20181208_1.reruns1.100.samples,
  E1G.20181208_2.reruns1.10.samples,
  E1G.20181209_1.reruns1.10.samples,
  E1G.20181209_2.reruns1.20.samples,
  E1G.20181209_3.reruns1.20.samples,
  E1G.20181209_4.reruns1.20.samples,
  E1G.20181209_5.reruns1.20.samples,
  E1G.20181209_6.reruns1.20.samples
)

FINAL.E1G.2018.samples.table<-write.table(as.data.frame(FINAL.E1G.2018.samples),file="FINAL.E1G.2018.samples.table.txt")

FINAL.PdG.2018.samples<- rbind(
  PdG.20181101.testplate.samples,
  PdG.20181103_1.cali.samples,
  PdG.20181103_2.cali_chai.samples,
  PdG.20181104_1.chai_papaya.samples,
  PdG.20181104_2.papaya_poquer.samples,
  PdG.20181104_3.poquer.samples,
  PdG.20181105_1.poquer_pepa.samples,
  PdG.20181105_2.pepa_policarpa.samples,
  PdG.20181108_1.policarpa_papaya_cuenca.samples, 
  PdG.20181108_2.cuenca_der.samples,
  PdG.20181113_1.der_gwen.samples,
  PdG.20181113_2.gwen.samples,
  PdG.20181113_3.gwen_others.samples
)

FINAL.PdG.2018.samples.table<-write.table(as.data.frame(FINAL.PdG.2018.samples),file="FINAL.PdG.2018.samples.table.txt")

```

2. Data frame for pool values

```{r}
FINAL.E1G.2018.pools<- rbind(
  E1G.20181101.testplate.pools,
  E1G.20181115_1.cali.pools,
  E1G.20181115_2.cali_chai.pools,
  E1G.20181115_3.chai_papaya.pools,
  E1G.20181115_4.papaya.pools,
  E1G.20181116_1.papaya_poquer.pools,
  E1G.20181116_2.poquer_pepa.pools,
  E1G.20181116_3.pepa.pools,
  E1G.20181116_4.policarpa.pools,
  E1G.20181117_1.policarpa_cuenca_der.pools,
  E1G.20181117_2.der.pools,
  E1G.20181117_3.der_gwen.pools,
  E1G.20181117_4.gwen_males.pools,
  E1G.20181205_1.reruns040_211.pools,
  E1G.20181205_2.reruns213_297.pools,
  E1G.20181208_1.reruns1.100.pools,
  E1G.20181208_2.reruns1.10.pools,
  E1G.20181209_2.reruns1.20.pools,
  E1G.20181209_1.reruns1.10.pools,
  E1G.20181209_3.reruns1.20.pools,
  E1G.20181209_4.reruns1.20.pools,
  E1G.20181209_5.reruns1.20.pools,
  E1G.20181209_6.reruns1.20.pools
)

FINAL.E1G.2018.pools.table<-write.table(as.data.frame(FINAL.E1G.2018.pools),file="FINAL.E1G.2018.pools.table.txt")
  
FINAL.PdG.2018.pools<- rbind(
  PdG.20181101.testplate.pools,
  PdG.20181103_1.cali.pools,
  PdG.20181103_2.cali_chai.pools,
  PdG.20181104_1.chai_papaya.pools,
  PdG.20181104_2.papaya_poquer.pools,
  PdG.20181104_3.poquer.pools,
  PdG.20181105_1.poquer_pepa.pools,
  PdG.20181105_2.pepa_policarpa.pools,
  PdG.20181108_1.policarpa_papaya_cuenca.pools,
  PdG.20181108_2.cuenca_der.pools,
  PdG.20181103_1.der_gwen.pools,
  PdG.20181103_2.gwen.pools,
  PdG.20181103_3.gwen_others.pools
)

FINAL.PdG.2018.pools.table<-write.table(as.data.frame(FINAL.PdG.2018.pools),file="FINAL.PdG.2018.pools.table.txt")
```